id,category,enforcement_type,statement,locations,code_flow,obligation_gap,code_gap
EIP1559-OBL-001,execution semantics,,The GASPRICE (0x3a) opcode MUST return the effective_gas_price as defined in the reference implementation.,"[vm/instructions/environment.py:gasprice, vm/__init__.py:TransactionEnvironment.gas_price, fork.py:check_transaction]",,,
EIP1559-OBL-002,tx validation,,"As of FORK_BLOCK_NUMBER, a new EIP-2718 transaction is introduced with TransactionType 2.","[transactions.py:FeeMarketTransaction, transactions.py:decode_transaction, transactions.py:encode_transaction, __init__.py:FORK_CRITERIA]",,,
EIP1559-OBL-003,fees,,The intrinsic cost of the new transaction type 2 is 21000 + 16 * non-zero calldata bytes + 4 * zero calldata bytes + 1900 * access list storage key count + 2400 * access list address count.,"[transactions.py:calculate_intrinsic_cost, transactions.py:TX_BASE_COST, transactions.py:TX_DATA_COST_PER_NON_ZERO, transactions.py:TX_DATA_COST_PER_ZERO, transactions.py:TX_ACCESS_LIST_STORAGE_KEY_COST, transactions.py:TX_ACCESS_LIST_ADDRESS_COST]",,,
EIP1559-OBL-004,tx validation,,"The EIP-2718 TransactionPayload for type 2 transactions is rlp([chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, destination, amount, data, access_list, signature_y_parity, signature_r, signature_s]).","[transactions.py:FeeMarketTransaction, transactions.py:encode_transaction]",,,
EIP1559-OBL-005,tx validation,,"The signature_y_parity, signature_r, signature_s elements of a type 2 transaction represent a secp256k1 signature over keccak256(0x02 || rlp([chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, destination, amount, data, access_list])).","[transactions.py:signing_hash_1559, transactions.py:recover_sender]",,,
EIP1559-OBL-006,tx validation,,"The EIP-2718 ReceiptPayload for type 2 transactions is rlp([status, cumulative_transaction_gas_used, logs_bloom, logs]).","[blocks.py:Receipt, blocks.py:encode_receipt]",,,
EIP1559-OBL-007,block validation,,A block's gas_used must not exceed its gas_limit.,[fork.py:validate_header:L320-L321],,,
EIP1559-OBL-008,block validation,,A block's gas_limit must be less than parent_gas_limit + parent_gas_limit // 1024.,"[fork.py:check_gas_limit:L884-L886, fork.py:GAS_LIMIT_ADJUSTMENT_FACTOR]",,,
EIP1559-OBL-009,block validation,,A block's gas_limit must be greater than parent_gas_limit - parent_gas_limit // 1024.,"[fork.py:check_gas_limit:L887-L888, fork.py:GAS_LIMIT_ADJUSTMENT_FACTOR]",,,
EIP1559-OBL-010,block validation,,A block's gas_limit must be at least 5000.,"[fork.py:check_gas_limit:L889-L890, fork.py:GAS_LIMIT_MINIMUM]",,,
EIP1559-OBL-011,base fee adjustment,,"At the fork block (INITIAL_FORK_BLOCK_NUMBER), the base_fee_per_gas must equal INITIAL_BASE_FEE (1000000000 wei).","[fork.py:validate_header:L325-L326, fork.py:INITIAL_BASE_FEE]",,,
EIP1559-OBL-012,base fee adjustment,,"When parent_gas_used equals parent_gas_target, the expected_base_fee_per_gas equals parent_base_fee_per_gas.",[fork.py:calculate_base_fee_per_gas:L252-L253],,,
EIP1559-OBL-013,base fee adjustment,,"When parent_gas_used exceeds parent_gas_target, the base_fee_per_gas must increase by max(parent_base_fee_per_gas * gas_used_delta // parent_gas_target // BASE_FEE_MAX_CHANGE_DENOMINATOR, 1).","[fork.py:calculate_base_fee_per_gas:L254-L267, fork.py:BASE_FEE_MAX_CHANGE_DENOMINATOR]",,,
EIP1559-OBL-014,base fee adjustment,,"When parent_gas_used is below parent_gas_target, the base_fee_per_gas must decrease by parent_base_fee_per_gas * gas_used_delta // parent_gas_target // BASE_FEE_MAX_CHANGE_DENOMINATOR.","[fork.py:calculate_base_fee_per_gas:L268-L280, fork.py:BASE_FEE_MAX_CHANGE_DENOMINATOR]",,,
EIP1559-OBL-015,block validation,,A block's base_fee_per_gas must match the expected_base_fee_per_gas calculated from the parent block.,"[fork.py:validate_header:L336-L337, fork.py:calculate_base_fee_per_gas]",,,
EIP1559-OBL-016,tx validation,,"After deducting transaction.amount from signer.balance, the balance must be non-negative.",[fork.py:check_transaction:L513-L514],,,
EIP1559-OBL-017,tx validation,,The signer's balance must be at least transaction.gas_limit * transaction.max_fee_per_gas.,[fork.py:check_transaction:L502-L514],,,
EIP1559-OBL-018,tx validation,,A transaction's max_fee_per_gas must be greater than or equal to block.base_fee_per_gas.,"[fork.py:check_transaction:L492-L495, exceptions.py:InsufficientMaxFeePerGasError]",,,
EIP1559-OBL-019,tx validation,,A transaction's max_fee_per_gas must be less than 2^256.,[transactions.py:FeeMarketTransaction.max_fee_per_gas],,,
EIP1559-OBL-020,tx validation,,A transaction's max_priority_fee_per_gas must be less than 2^256.,[transactions.py:FeeMarketTransaction.max_priority_fee_per_gas],,,
EIP1559-OBL-021,tx validation,,A transaction's max_fee_per_gas must be greater than or equal to its max_priority_fee_per_gas.,"[fork.py:check_transaction:L487-L491, exceptions.py:PriorityFeeGreaterThanMaxFeeError]",,,
EIP1559-OBL-022,tx validation,,"After deducting gas costs from signer.balance, the balance must be non-negative.","[fork.py:check_transaction:L513-L514, fork.py:process_transaction:L772-L777]",,,
EIP1559-OBL-023,fees,,"The priority_fee_per_gas is calculated as min(transaction.max_priority_fee_per_gas, transaction.max_fee_per_gas - block.base_fee_per_gas).",[fork.py:check_transaction:L497-L500],,,
EIP1559-OBL-024,fees,,The effective_gas_price is calculated as priority_fee_per_gas + block.base_fee_per_gas.,[fork.py:check_transaction:L501],,,
EIP1559-OBL-025,fees,,The signer's balance must be debited by transaction.gas_limit * effective_gas_price upfront before execution.,[fork.py:process_transaction:L767-L777],,,
EIP1559-OBL-026,fees,,"After transaction execution, the signer must be refunded gas_refund * effective_gas_price for unused gas.",[fork.py:process_transaction:L801-L817],,,
EIP1559-OBL-027,fees,,The miner (block author) must receive gas_used * priority_fee_per_gas.,[fork.py:process_transaction:L810-L828],,,
EIP1559-OBL-028,fees,,The base_fee_per_gas is burned (not given to anyone).,[fork.py:process_transaction:L810-L811],,,
EIP1559-OBL-029,block validation,,The cumulative_transaction_gas_used must equal the block's gas_used field.,"[fork.py:state_transition:L202-L205, blocks.py:Receipt.cumulative_gas_used]",,,
EIP1559-OBL-030,base fee adjustment,,"On the fork block, the parent_gas_target is set to parent.gas_limit (not divided by ELASTICITY_MULTIPLIER).",[fork.py:validate_header:L323-L334],,,
EIP1559-OBL-031,base fee adjustment,,"On the fork block, the parent_gas_limit is set to parent.gas_limit * ELASTICITY_MULTIPLIER.",[fork.py:validate_header:L323-L334],,,
EIP1559-OBL-032,base fee adjustment,,The gas_target for a block is calculated as gas_limit // ELASTICITY_MULTIPLIER (where ELASTICITY_MULTIPLIER = 2).,"[fork.py:calculate_base_fee_per_gas:L248, fork.py:ELASTICITY_MULTIPLIER]",,,
EIP1559-OBL-033,base fee adjustment,,The BASE_FEE_MAX_CHANGE_DENOMINATOR constant equals 8.,[fork.py:BASE_FEE_MAX_CHANGE_DENOMINATOR],,,
EIP1559-OBL-034,tx validation,,Transaction signature and chain ID must be validated before normalizing the transaction.,[transactions.py:recover_sender],,,
EIP1559-OBL-035,tx validation,,Legacy transactions must be normalized with gas_price mapped to both max_priority_fee_per_gas and max_fee_per_gas.,[fork.py:check_transaction:L503-L507],,,
EIP1559-OBL-036,tx validation,,EIP-2930 transactions must be normalized with gas_price mapped to both max_priority_fee_per_gas and max_fee_per_gas.,[fork.py:check_transaction:L503-L507],,,
