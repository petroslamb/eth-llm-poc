name: Manual Run

on:
  workflow_dispatch:
    inputs:
      eip:
        description: "EIP number"
        required: false
        type: string
      fork:
        description: "Execution-specs fork"
        required: false
        type: string
      client:
        description: "Execution client"
        required: false
        type: string
      client_ref:
        description: "Execution client ref"
        required: false
        type: string
      phases:
        description: "Comma-separated phase list"
        required: false
        type: string
      model:
        description: "Claude model"
        required: false
        type: string
      max_turns:
        description: "Max turns per phase"
        required: false
        type: string
      eips_ref:
        description: "EIPs repo branch"
        required: false
        type: string
      execution_specs_ref:
        description: "Execution-specs repo ref"
        required: false
        type: string
      llm_mode:
        description: "LLM mode (live or fake)"
        required: false
        type: string
      pypi_package:
        description: "Git ref or PyPI version to install eip-verify from (default: local path)"
        required: false
        type: string

permissions:
  contents: read
  actions: write

jobs:
  defaults:
    uses: ./.github/workflows/resolve_defaults.yml
    with:
      profile: "single"
      eip: ${{ inputs.eip }}
      fork: ${{ inputs.fork }}
      client: ${{ inputs.client }}
      client_ref: ${{ inputs.client_ref }}
      phases: ${{ inputs.phases }}
      model: ${{ inputs.model }}
      max_turns: ${{ inputs.max_turns }}
      eips_ref: ${{ inputs.eips_ref }}
      execution_specs_ref: ${{ inputs.execution_specs_ref }}
      llm_mode: ${{ inputs.llm_mode }}
      pypi_package: ${{ inputs.pypi_package }}

  run-scan:
    needs: defaults
    uses: ./.github/workflows/ci.yml
    with:
      eip: ${{ needs.defaults.outputs.eip }}
      fork: ${{ needs.defaults.outputs.fork }}
      client: ${{ needs.defaults.outputs.client }}
      client_ref: ${{ needs.defaults.outputs.client_ref }}
      phases: ${{ needs.defaults.outputs.phases }}
      model: ${{ needs.defaults.outputs.model }}
      max_turns: ${{ needs.defaults.outputs.max_turns }}
      eips_ref: ${{ needs.defaults.outputs.eips_ref }}
      execution_specs_ref: ${{ needs.defaults.outputs.execution_specs_ref }}
      llm_mode: ${{ needs.defaults.outputs.llm_mode }}
      pypi_package: ${{ needs.defaults.outputs.pypi_package }}
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
